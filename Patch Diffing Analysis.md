# Patch Diffing Analysis



# start with outline (copy/paste it here)
- Applying the patch
	- Identify changes, robustness of patch
	- Systems affected 	- 
- Analyze Security Patch
	- Does the security patch fix the root cause, band aid or cure?
	- What to do next?
		- Variant analysis
		- Are there other paths that reach this code?
		- Refraction thinking - Does this root cause exist in any other related subsystem?



>There are [plenty](https://googleprojectzero.blogspot.com/2017/10/using-binary-diffing-to-discover.html) [of](https://beistlab.files.wordpress.com/2012/10/isec_2012_beist_slides.pdf) resources [available](https://www.slideshare.net/cisoplatform7/bruh-do-you-even-diffdiffing-microsoft-patches-to-find-vulnerabilities) [on](https://apprize.best/security/ethical_1/20.html) [binary](http://joxeankoret.com/blog/2015/03/13/diaphora-a-program-diffing-plugin-for-ida-pro/) [diffing](https://deadlisting.com/files/Sims_Patch_Diff_BSides_Baltimore.pdf) and [comparing diffing tools](https://malware.news/t/comparative-analysis-between-bindiff-and-diaphora-patched-smokeloader-study-case/40996), so I won't be diving into how to use them, but for completeness sake, I'm going to diff the two kernels I just created!


## Even with the files, its d1ifficult to spot changes
>Security patches are often made to applications, libraries, driver files, etc.
When a new version is released it can be difficult to locate what changes were made
Some are new features or general application changes
Some are security fixes Some changes are intentional to thwart reversing
Some vendors make it clear as to reasoning for the update to the binary
Binary diffing tools can help us locate the changes [](https://www.slideshare.net/cisoplatform7/bruh-do-you-even-diffdiffing-microsoft-patches-to-find-vulnerabilities?from_action=save)


## Why again?

Closed vs open source. Need for patch diffing. 


### Alternative - Identify a Patch of Interest 
#develop 
- Going from the KB article with patch detail to a particular CVE. 
- Useful for the latter step of finding the patched binary [Environment Setup and Tooling](Environment%20Setup%20and%20Tooling.md)

Notes: 


### show mermaid where patch analysis comes in to help system comprehension and security patch effectiveness evaluation


## Process

- [Patch Diffing with Ghidra (threatrack.de)](https://blog.threatrack.de/2019/10/02/ghidra-patch-diff/#finding-the-patch)
	- finish with prescribed correlator
	- 

1. import first binary, analyze (get symbols first)
2. import 2nd binary, anaylze (get symbols first)
3. Load up version tracking (used to upgrade markup, now for patch diffing)
4. Run this sequence of correlators




Research: 
- [binexport/java/BinExport at master · google/binexport · GitHub](https://github.com/google/binexport/tree/master/java/BinExport#installing-the-ghidra-extension)
- [Patch Diffing with Ghidra - Low-level Shenanigans (ihack4falafel.github.io)](https://ihack4falafel.github.io/Patch-Diffing-with-Ghidra/)


## Example

`IsSpoolerImpersonating` - find this during the patch diff.
	- Base -> Specific Patch
	- Base -> n-1 -> Specific Patch
	- ### how to find the n-1?


# Reason why patch wasn't robust

Cost benefit analysis. Sometimes the cure is more painful than the cost.  several competing priorities. 

	
Sources - 

https://www.trendmicro.com/en_us/research/19/i/from-bindiff-to-zero-day-a-proof-of-concept-exploiting-cve-2019-1208-in-internet-explorer.html