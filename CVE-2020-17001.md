# CVE-2020-17001

tags: #cve-analysis

- metadata
	- CVE #:  CVE-2020-17001
	- Related CWE(s):
		- [Insufficient Control Flow Management \- (691)](https://cwe.mitre.org/data/definitions/691.html)
			- [Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') \- (362)](https://cwe.mitre.org/data/definitions/362.html)
				- [CWE - 367 - Time-of-check Time-of-use (TOCTOU) Race Condition](https://cwe.mitre.org/data/definitions/367.html)
					- [CWE - 363 - Race Condition Enabling Link Following](https://cwe.mitre.org/data/definitions/363.html)
		- [CWE - 664 - Improper Control of a Resource Through its Lifetime \- (664)](https://cwe.mitre.org/data/definitions/664.html)
			- [Use of Incorrectly-Resolved Name or Reference \- (706)](https://cwe.mitre.org/data/definitions/706.html)
				- [CWE - 59 - Improper Link Resolution Before File Access ('Link Following')](https://cwe.mitre.org/data/definitions/59.html)
	- Related CVE(s): 
		- [CVE-2020-1337](CVE-2020-1337.md) 
		- [CVE-2020-1048](CVE-2020-1048.md)
	- created: 2021-01-29
	- title: Windows: Local Spooler CVE-2020-1337 Bypass
	- web:  https://bugs.chromium.org/p/project-zero/issues/detail?id=2075&q=CVE-2020-17001&can=1
	- platform: Windows
	- descriptor tags: #cve #security #pathCanonacalization 


# CVE-2020-17001

## Summary
>The fix for CVE-2020-1337 is incomplete and is still vulnerable to a TOCTOU issue.
> You can bypass the fix for CVE-2020-1337, which seems to involve checking the final pathname and whether there’s any hardlinks by using a local SMB path as your target. As the path returned from GetFinalPathNameByHandle is the UNC path this doesn’t change even if the directory locally becomes a mount point.

This is yet another way to write an arbitrary file as `SYSTEM`. Actually it is the same way as [CVE-2020-1048](CVE-2020-1048.md), just another bypass.   

## Components affected

- **Windows Print Spooler** - issue with underlying path resolution subsytem in Windows. Specifically a [UNC path](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-dtyp/62e862f4-2a51-452e-8eeb-dc4ff5ee33cc). 
- **Windows File-Based Canonicalization** - 

## Security Boundaries 
*which [security boundaries](https://www.microsoft.com/en-us/msrc/windows-security-servicing-criteria) have been crossed?*

- **User** - A user cannot access or tamper with the code and data of another user without being authorized.

## Requirements
*what stars needed to align?*

- User context
- Use of UNC path for that of the printer port. 

## Root Cause
[CWE-59: Improper Link Resolution Before File Access ('Link Following')](https://cwe.mitre.org/data/definitions/59.html)

>4.The GetFinalPathNameByHandle function will try to retrieve the final path of the UNC path, but won’t be able to, so it will return the UNC path which the user has write permissions to, which means the exploitation will be successful.

### CVE root or causal factor?
*was the reported vulnerability the overarching issue, or just a causal factor*




## Patch Info

- Patch link : https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-17001

#develop  fill in this table


| Release Date | Product | Platform | impact | Severity | Article | Download | Details |
|---|---|---|---|---|---|---|---|
|01/12/2021|Windows 10 Version 2004 for x64-based Systems|-|Security Feature Bypass|Important|[4598242](https://support.microsoft.com/help/4598242)|[Security Update](https://catalog.update.microsoft.com/v7/site/Search.aspx?q=KB4598242)|[CVE-2021-1678](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-1678)|

